---
title: "Advanced Topics & Troubleshooting"
description: "Advanced techniques, troubleshooting guides, and solutions for complex scenarios with UI Lab."
category: "guides"
publishedOn: "2025-12-14"
tags: ["advanced", "troubleshooting", "faq", "performance", "customization"]
---

# Advanced Topics & Troubleshooting

This guide covers advanced scenarios, troubleshooting, and answers to frequently asked questions.

---

## Troubleshooting

### Issue: Components Not Styled (Unstyled Appearance)

**Symptoms:** Buttons and inputs appear without styling, just plain HTML elements.

**Causes:**
- Styles not imported
- CSS not loading in browser
- Tailwind CSS not configured
- PostCSS pipeline broken

**Solutions:**

**Step 1: Verify styles import**
```tsx
// app.tsx or main.tsx (top of file, before components)
import 'ui-lab-components/styles.css';
```

This must be imported exactly once at application root.

**Step 2: Check browser DevTools**
```
F12 ‚Üí Elements ‚Üí Look for <link> to ui-lab-components/styles.css
```

If the stylesheet isn't loaded, check network tab for 404 errors.

**Step 3: Verify Tailwind CSS**
```json
// tailwind.config.js or postcss.config.mjs
{
  "plugins": {
    "@tailwindcss/postcss": {}
  }
}
```

**Step 4: Check PostCSS**
```bash
# Verify PostCSS plugin is installed
npm list postcss @tailwindcss/postcss

# If missing, install:
npm install -D postcss @tailwindcss/postcss
```

**Step 5: Rebuild your project**
```bash
# Clear cache and rebuild
rm -rf node_modules/.vite       # For Vite
rm -rf .next                    # For Next.js
npm run build
```

**Verification:**
```tsx
import 'ui-lab-components/styles.css';
import { Button } from 'ui-lab-components';

export default function App() {
  return <Button>If you see a blue button, styles are working!</Button>;
}
```

---

### Issue: TypeScript Errors with Components

**Symptoms:** TypeScript errors when importing or using components.

**Causes:**
- Old TypeScript version
- Missing type definitions
- Strict mode issues
- Incorrect imports

**Solutions:**

**Step 1: Update TypeScript**
```bash
npm install -D typescript@latest

# Verify version
npx tsc --version  # Should be 5.x or higher
```

**Step 2: Check Component Imports**
```tsx
// ‚úÖ Correct
import { Button, Input } from 'ui-lab-components';
import type { ButtonProps } from 'ui-lab-components';

// ‚ùå Incorrect
import Button from 'ui-lab-components/button';
import * as UI from 'ui-lab-components';  // Works but less specific
```

**Step 3: Enable Strict Mode (Recommended)**
```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true
  }
}
```

**Step 4: Type Props Correctly**
```tsx
import type { ButtonProps } from 'ui-lab-components';

interface MyComponentProps extends ButtonProps {
  customProp?: string;
}

export function MyComponent({ customProp, ...props }: MyComponentProps) {
  return <Button {...props} />;
}
```

**Verification:**
```bash
pnpm type-check
# Should complete without errors
```

---

### Issue: Styling Conflicts with Other Frameworks

**Symptoms:** Component styles are overridden by other CSS frameworks or global styles.

**Causes:**
- CSS specificity conflicts
- Global CSS resetting component styles
- CSS Module not properly scoped
- PostCSS plugin ordering issues

**Solutions:**

**Solution 1: CSS Specificity**
```css
/* ‚ùå Too generic ‚Äì can be overridden */
button {
  background: blue;
}

/* ‚úÖ Use CSS Modules for proper scoping */
.button {
  background: var(--color-primary);
}
```

**Solution 2: Isolation with CSS Modules**
```tsx
import styles from './MyButton.module.css';

export function MyButton(props) {
  return (
    <button className={styles.button} {...props}>
      Click me
    </button>
  );
}
```

**Solution 3: Override with CSS Variables**
If another framework is overriding colors, use CSS variables to take control:

```css
:root {
  --color-primary: oklch(68% 0.22 245) !important;
}
```

**Solution 4: Check PostCSS Plugin Order**
```javascript
// postcss.config.mjs
export default {
  plugins: {
    '@tailwindcss/postcss': {},
    // Other plugins must come AFTER Tailwind
    'postcss-custom-media': {},
  },
};
```

**Verification:**
```tsx
// Check computed styles
import { Button } from 'ui-lab-components';

export function Test() {
  const ref = useRef<HTMLButtonElement>(null);

  useEffect(() => {
    if (ref.current) {
      const styles = window.getComputedStyle(ref.current);
      console.log('Background:', styles.backgroundColor);
    }
  }, []);

  return <Button ref={ref}>Check Console</Button>;
}
```

---

### Issue: Performance Degradation with Many Components

**Symptoms:** Page is slow, lots of components rendering unnecessarily, high bundle size.

**Solutions:**

**1. Code Splitting**
```tsx
import { lazy, Suspense } from 'react';

const Modal = lazy(() => import('./Modal'));
const HeavyForm = lazy(() => import('./HeavyForm'));

function App() {
  const [showModal, setShowModal] = useState(false);

  return (
    <>
      {showModal && (
        <Suspense fallback={<div>Loading...</div>}>
          <Modal onClose={() => setShowModal(false)} />
        </Suspense>
      )}
    </>
  );
}
```

**2. Component Memoization**
```tsx
import { memo } from 'react';

// Only re-render when props actually change
const ExpensiveList = memo(function ExpensiveList({ items }: Props) {
  return (
    <div>
      {items.map((item) => (
        <div key={item.id}>{item.name}</div>
      ))}
    </div>
  );
});
```

**3. Bundle Analysis**
```bash
# Analyze your bundle
npm install -D webpack-bundle-analyzer

# Find what's taking space
npx webpack-bundle-analyzer dist/bundle.js
```

**4. Tree-Shaking**
```tsx
// ‚úÖ Only imported components are included
import { Button, Input } from 'ui-lab-components';

// ‚ùå Imports entire library
import * as UI from 'ui-lab-components';
```

**5. Lazy Load Routes (Next.js)**
```tsx
import dynamic from 'next/dynamic';

const HeavyComponent = dynamic(() => import('./HeavyComponent'), {
  loading: () => <div>Loading...</div>,
});
```

---

### Issue: Dark Mode Not Working

**Symptoms:** Dark mode toggle doesn't change component colors.

**Causes:**
- CSS variables not defined for dark mode
- Missing media query for prefers-color-scheme
- JavaScript not updating CSS properly

**Solutions:**

**Solution 1: Media Query Approach**
```css
/* Light mode (default) */
:root {
  --background-50: oklch(99.2% 0.001 240);
  --background-950: oklch(11.8% 0.018 240);
  --foreground-primary: oklch(11.8% 0.018 240);
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  :root {
    --background-50: oklch(11.8% 0.018 240);     /* Now dark */
    --background-950: oklch(99.2% 0.001 240);    /* Now light */
    --foreground-primary: oklch(99.2% 0.001 240);
  }
}
```

**Solution 2: JavaScript-Controlled with Persistence**
```tsx
import { useEffect, useState } from 'react';

export function DarkModeToggle() {
  const [isDark, setIsDark] = useState(() => {
    const stored = localStorage.getItem('dark-mode');
    if (stored !== null) return stored === 'true';
    return window.matchMedia('(prefers-color-scheme: dark)').matches;
  });

  useEffect(() => {
    const root = document.documentElement;
    root.style.colorScheme = isDark ? 'dark' : 'light';
    root.style.setProperty('--background-50', isDark ? 'oklch(11.8% 0.018 240)' : 'oklch(99.2% 0.001 240)');
    root.style.setProperty('--background-950', isDark ? 'oklch(99.2% 0.001 240)' : 'oklch(11.8% 0.018 240)');
    localStorage.setItem('dark-mode', isDark.toString());
  }, [isDark]);

  return (
    <button onClick={() => setIsDark(!isDark)}>
      {isDark ? '‚òÄÔ∏è Light' : 'üåô Dark'}
    </button>
  );
}
```

**Verification:**
```bash
# Check computed CSS variables
const style = getComputedStyle(document.documentElement);
console.log(style.getPropertyValue('--background-50'));
```

---

## Advanced Customization

### Creating Custom Variants

Extend components with custom variants:

```tsx
import styles from './CustomButton.module.css';
import { Button, type ButtonProps } from 'ui-lab-components';

interface CustomButtonProps extends ButtonProps {
  variant?: 'primary' | 'secondary' | 'gradient';
}

export function CustomButton({ variant = 'primary', ...props }: CustomButtonProps) {
  if (variant === 'gradient') {
    return <button className={styles.gradient} {...props} />;
  }

  return <Button variant={variant} {...props} />;
}
```

```css
/* CustomButton.module.css */
.gradient {
  background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
  color: white;
  @apply inline-flex items-center justify-center px-4 py-2 rounded-md font-medium;
}
```

### Component Extension with Higher-Order Components

Wrap components to add functionality:

```tsx
import { Button, type ButtonProps } from 'ui-lab-components';

interface WithLoadingProps extends ButtonProps {
  isLoading?: boolean;
}

export function withLoading(Component: React.ComponentType<ButtonProps>) {
  return function WithLoadingComponent({ isLoading, disabled, ...props }: WithLoadingProps) {
    return (
      <Component
        {...props}
        disabled={disabled || isLoading}
        aria-busy={isLoading}
      >
        {isLoading ? '...' : props.children}
      </Component>
    );
  };
}

// Usage
const LoadingButton = withLoading(Button);
<LoadingButton isLoading={true}>Submit</LoadingButton>
```

### Theme Customization

Create brand-specific themes:

```css
/* themes/brand.css */
@theme {
  /* Brand Colors */
  --color-primary: oklch(60% 0.25 15);     /* Brand orange */
  --color-secondary: oklch(50% 0.20 280);  /* Brand purple */

  /* Background Scale - Custom */
  --background-50: oklch(98% 0.001 20);
  --background-100: oklch(96% 0.002 20);
  --background-200: oklch(92% 0.004 20);
  --background-950: oklch(12% 0.020 20);

  /* Typography - Larger base */
  --text-base: 1.125rem;
  --text-lg: 1.375rem;

  /* Spacing - More generous */
  --spacing-4: 1.25rem;
  --spacing-6: 2rem;

  /* Radius - Rounder corners */
  --radius-md: 0.5rem;
  --radius-lg: 1rem;
}
```

Import in your app:
```tsx
import './themes/brand.css';
import 'ui-lab-components/styles.css';
```

### Dynamic Theme Switching

Change themes at runtime:

```tsx
const THEME_CSS = {
  light: 'https://cdn.example.com/themes/light.css',
  dark: 'https://cdn.example.com/themes/dark.css',
};

export function useTheme() {
  const [theme, setTheme] = useState<'light' | 'dark'>('light');

  const switchTheme = useCallback((newTheme: 'light' | 'dark') => {
    // Remove old theme
    const oldLink = document.querySelector('link[data-theme]');
    if (oldLink) oldLink.remove();

    // Add new theme
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = THEME_CSS[newTheme];
    link.dataset.theme = newTheme;
    document.head.appendChild(link);

    setTheme(newTheme);
    localStorage.setItem('theme', newTheme);
  }, []);

  return { theme, switchTheme };
}
```

---

## Form Handling Patterns

---

### Multi-Step Forms

Build complex forms with validation:

```tsx
import { useState } from 'react';
import { Button, Input, Label } from 'ui-lab-components';

interface FormData {
  name: string;
  email: string;
  message: string;
}

export function MultiStepForm() {
  const [step, setStep] = useState(1);
  const [data, setData] = useState<Partial<FormData>>({});
  const [errors, setErrors] = useState<Record<string, string>>({});

  const handleNext = () => {
    if (validateStep(step)) {
      setStep(step + 1);
    }
  };

  const validateStep = (currentStep: number): boolean => {
    const newErrors: Record<string, string> = {};

    if (currentStep === 1) {
      if (!data.name) newErrors.name = 'Name is required';
    } else if (currentStep === 2) {
      if (!data.email) newErrors.email = 'Email is required';
      else if (!/\S+@\S+\.\S+/.test(data.email))
        newErrors.email = 'Invalid email';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.currentTarget;
    setData((prev) => ({ ...prev, [name]: value }));
    // Clear error when user starts typing
    if (errors[name]) {
      setErrors((prev) => ({ ...prev, [name]: '' }));
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (validateStep(step)) {
      // Submit form
      console.log('Submitting:', data);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      {step === 1 && (
        <div>
          <Label htmlFor="name">Name</Label>
          <Input
            id="name"
            name="name"
            value={data.name || ''}
            onChange={handleChange}
            aria-invalid={!!errors.name}
          />
          {errors.name && <p style={{ color: 'var(--color-danger)' }}>{errors.name}</p>}
        </div>
      )}

      {step === 2 && (
        <div>
          <Label htmlFor="email">Email</Label>
          <Input
            id="email"
            name="email"
            type="email"
            value={data.email || ''}
            onChange={handleChange}
            aria-invalid={!!errors.email}
          />
          {errors.email && <p style={{ color: 'var(--color-danger)' }}>{errors.email}</p>}
        </div>
      )}

      {step === 3 && (
        <div>
          <Label htmlFor="message">Message</Label>
          <Input
            id="message"
            name="message"
            value={data.message || ''}
            onChange={handleChange}
          />
        </div>
      )}

      <div style={{ display: 'flex', gap: '1rem', marginTop: '2rem' }}>
        {step > 1 && (
          <Button variant="secondary" onClick={() => setStep(step - 1)}>
            Back
          </Button>
        )}
        {step < 3 ? (
          <Button onClick={handleNext}>Next</Button>
        ) : (
          <Button type="submit">Submit</Button>
        )}
      </div>

      <div>
        Step {step} of 3
      </div>
    </form>
  );
}
```

### Async Validation

Validate fields against a server:

```tsx
import { useState, useCallback } from 'react';
import { Input, Label } from 'ui-lab-components';

export function EmailInput() {
  const [email, setEmail] = useState('');
  const [isValidating, setIsValidating] = useState(false);
  const [error, setError] = useState('');

  const validateEmail = useCallback(async (value: string) => {
    if (!value || !value.includes('@')) {
      setError('Invalid email format');
      return;
    }

    setIsValidating(true);
    try {
      const response = await fetch('/api/validate-email', {
        method: 'POST',
        body: JSON.stringify({ email: value }),
      });

      const { isValid } = await response.json();
      setError(isValid ? '' : 'Email already registered');
    } catch (err) {
      setError('Validation failed');
    } finally {
      setIsValidating(false);
    }
  }, []);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const newEmail = e.currentTarget.value;
    setEmail(newEmail);
    validateEmail(newEmail);
  };

  return (
    <div>
      <Label htmlFor="email">Email</Label>
      <Input
        id="email"
        type="email"
        value={email}
        onChange={handleChange}
        disabled={isValidating}
        aria-invalid={!!error}
        aria-busy={isValidating}
      />
      {error && <p style={{ color: 'var(--color-danger)' }}>{error}</p>}
      {isValidating && <p>Checking...</p>}
    </div>
  );
}
```

---

## Common Pitfalls

---

### 1. Forgetting to Import Styles

‚ùå **Don't forget styles:**
```tsx
import { Button } from 'ui-lab-components';
// No styles imported ‚Äì button is unstyled!
```

‚úÖ **Always import styles:**
```tsx
import 'ui-lab-components/styles.css';
import { Button } from 'ui-lab-components';
```

### 2. Misusing Variant Props

‚ùå **Don't invent variants:**
```tsx
<Button variant="purple">Not a real variant</Button>
```

‚úÖ **Use real variants:**
```tsx
<Button variant="primary">Correct</Button>
```

### 3. Ignoring Accessibility

‚ùå **Don't skip accessibility:**
```tsx
<Input placeholder="Email" />  // No label
<Button icon={<Icon />} />     // No aria-label
```

‚úÖ **Always add labels:**
```tsx
<Label htmlFor="email">Email</Label>
<Input id="email" />

<Button icon={<Icon />} aria-label="Delete" />
```

### 4. Memory Leaks in Effects

‚ùå **Don't forget cleanup:**
```tsx
useEffect(() => {
  const timer = setInterval(doSomething, 1000);
  // Missing cleanup ‚Äì timer runs forever
}, []);
```

‚úÖ **Always cleanup:**
```tsx
useEffect(() => {
  const timer = setInterval(doSomething, 1000);
  return () => clearInterval(timer);  // Cleanup
}, []);
```

### 5. Missing TypeScript Types

‚ùå **Don't skip types:**
```tsx
export function MyButton(props) {  // No type
  return <Button {...props} />;
}
```

‚úÖ **Always add types:**
```tsx
import { type ButtonProps } from 'ui-lab-components';

export function MyButton(props: ButtonProps) {
  return <Button {...props} />;
}
```

---

## FAQ

---

### Q: How do I customize component colors for my brand?

**A:** Override CSS variables in your root CSS: `--color-primary`, `--color-secondary`, etc. See [Styling Guide](/docs/styling#customizing-component-styles).

### Q: Can I use UI Lab with different CSS frameworks?

**A:** Yes. CSS Modules isolate component styles to prevent conflicts. Tailwind CSS v4 is recommended for best integration.

### Q: How do I reduce the bundle size?

**A:** Import only needed components: `import { Button, Input } from 'ui-lab-components'`. Avoid `import * as UI`.

### Q: Can I extend component behavior?

**A:** Yes, create wrapper components that extend props and add custom logic. See [Component Composition](/docs/best-practices#component-composition).

### Q: How do I handle server-side rendering?

**A:** Components are SSR-safe. Import `'ui-lab-components/styles.css'` in your root layout once.

### Q: How do I support multiple themes?

**A:** Switch CSS variables at runtime using `document.documentElement.style.setProperty()`. See [Theme Customization](/docs/styling#theme-customization).

### Q: Can I use UI Lab with form libraries?

**A:** Yes. Components work seamlessly with React Hook Form, Formik, and other form libraries using standard React patterns.

---

## Performance Tips

---

1. **Lazy load heavy components** ‚Äì Use dynamic imports
2. **Memoize expensive calculations** ‚Äì Use useMemo and useCallback
3. **Keep CSS variables** ‚Äì Don't inline styles
4. **Code split by route** ‚Äì Reduce initial load
5. **Monitor bundle size** ‚Äì Use webpack-bundle-analyzer
6. **Use CSS modules** ‚Äì Scoped styles are more efficient
7. **Tree-shake unused code** ‚Äì Only import what you use

---

## Getting Help

- **GitHub Issues:** https://github.com/kyza0d/ui-lab.app/issues
- **Provide:** Framework, environment, error message, minimal reproduction
- **Include:** `pnpm list ui-lab-components`, Node version, browser info
