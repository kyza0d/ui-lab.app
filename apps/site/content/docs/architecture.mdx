---
title: "Architecture & Monorepo"
description: "Understanding the UI Lab monorepo structure, packages, and how everything works together."
category: "Architecture & Advanced"
publishedOn: "2025-12-14"
tags: ["architecture", "monorepo", "structure", "contributing"]
---

# Architecture & Monorepo

UI Lab is organized as a pnpm monorepo with a clear separation of concerns across packages and applications. This guide explains the structure, how packages interact, and how the build system works.

---

## Monorepo Overview

UI Lab uses **pnpm workspaces** to manage multiple packages and applications in a single repository, providing shared dependencies, workspace linking via `workspace:*` protocol, unified builds, and isolated development per package.

```
ui-lab/
├── packages/
│   ├── components/           @ui-lab/components (Component library)
│   ├── cli/                  ui-lab (Installation CLI tool)
│   └── registry/             ui-lab-registry (Component metadata)
├── apps/
│   └── site/                 @ui-lab/site (Documentation website)
├── pnpm-workspace.yaml       Workspace configuration
└── package.json              Root-level scripts
```

---

## Packages Structure

### @ui-lab/components

**Location:** `packages/components`

The core component library with 27+ production-ready React components. Built with React Aria for WCAG AA accessibility, uses CSS Modules for scoped styles, semantic CSS variables for theming, and outputs ESM + UMD builds with zero runtime dependencies.

**Directory Structure:**
```
packages/components/
├── src/
│   ├── components/           # 27+ component directories
│   │   ├── button/
│   │   │   ├── button.tsx    # React component
│   │   │   ├── button.module.css      # Scoped styles
│   │   │   └── index.ts      # Exports
│   │   └── [others...]
│   ├── lib/
│   │   └── utils.ts          # cn() utility for classnames
│   ├── index.ts              # Main entry point
│   ├── styles.css            # Global CSS variables
│   ├── vite.config.ts        # Build configuration
│   └── postcss.config.mjs     # PostCSS for Tailwind
├── dist/                     # Built outputs
└── package.json
```

**Build System:** Vite 5 with:
- React JSX support
- TypeScript compilation
- CSS Modules
- vite-plugin-dts for type definitions
- PostCSS with Tailwind CSS v4

**Build Output:**
- **UMD format:** `dist/ui-lab-ui.umd.js` – For browser usage
- **ESM format:** `dist/ui-lab-ui.es.js` – For modern bundlers
- **Type definitions:** `dist/index.d.ts` – TypeScript support
- **Compiled CSS:** `dist/styles.css` – All component styles

**Exports:**
```json
{
  "main": "./dist/ui-lab-ui.umd.js",
  "module": "./dist/ui-lab-ui.es.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": { "import", "require", "types" },
    "./styles.css": "./dist/styles.css"
  }
}
```

### ui-lab-registry

Auto-generated component metadata and discovery system used by the CLI and documentation site.

**Location:** `packages/registry`

**Purpose:** Provides component definitions, prop documentation, and metadata for all components.

**Key Exports:**
- `componentRegistry` – All component definitions
- `componentMetadata` – Detailed component information
- `generatedAPI` – Component prop documentation
- `generatedComponentDependencies` – Component interdependencies
- `categories` – Component categorization system

**Helper Functions:**

<MarkdownTable markdown="| Function | Purpose |\n|----------|----------|\n| \`getComponentById(id)\` | Retrieve component by ID |\n| \`getComponentsByCategory(category)\` | Filter by category |\n| \`getComponentsGroupedByCategory()\` | Group all by category |\n| \`searchComponents(query)\` | Search component registry |\n| \`getAllComponentIds()\` | List all component IDs |\n| \`getComponentCount()\` | Count total components |" />

**Directory Structure:**
```
packages/registry/
├── src/
│   ├── index.ts              # Main exports
│   ├── registry.ts           # Component definitions
│   ├── categories.ts         # Categorization
│   ├── helpers.ts            # Query utilities
│   ├── types.ts              # TypeScript definitions
│   ├── generated-data.ts     # Auto-generated data
│   └── generated/            # Generated files
├── scripts/
│   └── generate-registry-data.ts    # Generation script
└── package.json
```

**Build System:** TypeScript compiler (tsc)

**Generation:** Uses `react-docgen-typescript` to introspect component prop types automatically.

---

### ui-lab (CLI Tool)

Command-line interface for initializing projects and installing components.

**Location:** `packages/cli`

**Purpose:** Provides `ui-lab init` and `ui-lab install` commands for developer workflow.

**Commands:**
- `npx ui-lab init` – Initialize new projects with UI Lab
- `npx ui-lab install <components>` – Install specific components

**Directory Structure:**
```
packages/cli/
├── src/
│   ├── bin/
│   │   └── ui-lab.ts         # CLI entry point
│   ├── commands/
│   │   ├── init.ts           # Initialization command
│   │   └── install.ts        # Installation command
│   ├── core/
│   │   ├── installer.ts      # Component installation logic
│   │   ├── registry-client.ts    # Registry API
│   │   ├── dependency-resolver.ts   # Resolves dependencies
│   │   ├── package-manager.ts  # npm/pnpm operations
│   │   ├── config-manager.ts   # Project configuration
│   │   └── theme-generator.ts  # Theme CSS generation
│   ├── detectors/            # Framework detection
│   ├── scaffolders/          # Project scaffolding
│   ├── templates/            # Code templates
│   └── lib/                  # Utilities
├── dist/                     # Compiled output
└── package.json
```

**Build System:** tsup (TypeScript bundler for CLI)

**Features:**
- Framework detection (Next.js, Vite)
- Interactive prompts with @clack/prompts
- Dependency resolution
- Theme preset templates
- Component validation with suggestions

**Node Requirement:** 18+

---

## Apps Structure

### @ui-lab/site

Interactive documentation and component showcase website built with Next.js.

**Location:** `apps/site`

**Framework:** Next.js 16 + React 19

**Purpose:** Provides searchable component documentation with interactive demos.

**Directory Structure:**
```
apps/site/
├── src/app/
│   ├── page.tsx              # Home page
│   ├── layout.tsx            # Root layout
│   ├── globals.css           # Global styles
│   ├── docs/                 # Documentation pages
│   │   ├── layout.tsx
│   │   ├── overview/
│   │   ├── architecture/
│   │   └── [slug]/
│   ├── components/           # Site components
│   └── lib/component-demos/  # Interactive examples
├── public/                   # Static assets
├── content/docs/             # MDX documentation
├── next.config.ts            # Next.js config
├── postcss.config.mjs        # PostCSS config
└── package.json
```

**Styling:**
- Tailwind CSS v4
- CSS Modules (page-level)
- CSS variables system

**Key Dependencies:**
- next-mdx-remote-client – MDX rendering
- shiki – Code syntax highlighting
- @react-three/fiber + three – 3D graphics
- ui-lab-components – Component library
- ui-lab-registry – Component metadata

**Features:**
- Live component previews
- MDX documentation
- Code syntax highlighting with Shiki
- 3D visualization (Three.js)
- Component search and discovery
- Responsive design showcase

---

## Build Pipeline

### Development Mode

```bash
pnpm dev           # Run all dev servers (site + packages)
pnpm dev:site      # Next.js site only
```

During development:
- Component library is watched with Vite HMR
- Site reloads with Next.js fast refresh
- Registry can be regenerated on demand
- No build step needed for quick feedback

### Production Build

```bash
pnpm build         # Build everything
pnpm build:packages    # Build component library only
pnpm build:site    # Build Next.js site
```

**Build Process:**

1. **Components:** Vite bundles to ESM/UMD + types → `dist/ui-lab-ui.{es,umd}.js`, `dist/styles.css`, `dist/index.d.ts`
2. **Registry:** TypeScript compilation + metadata generation → `dist/index.js`
3. **CLI:** tsup bundles to executable → `dist/bin/ui-lab.js`
4. **Site:** Next.js optimization → static HTML + JS bundles

### Type Checking

```bash
pnpm type-check    # Check TypeScript across all packages
```

Runs `tsc --noEmit` to verify all packages compile correctly without output.

---

## Dependency Management

### Package Manager

**pnpm 10.21.0** is required and enforced via preinstall script.

**Workspace References:**
Use `workspace:*` protocol to reference local packages:

```json
{
  "dependencies": {
    "ui-lab-components": "workspace:*",
    "ui-lab-registry": "workspace:*"
  }
}
```

### Shared Dependencies

**Core Runtime:**
- `react@19.x` – UI framework
- `react-dom@19.x` – DOM rendering
- `react-aria@3.44.0` – Accessibility
- `react-stately@3.42.0` – State management
- `@floating-ui/react-dom@2.1.6` – Popover positioning

**Component Utilities:**
- `clsx@2.0.0` – Classname merging
- `class-variance-authority@0.7.0` – Variant management
- `lucide-react@0.525.0` – Icons
- `cmdk@1.1.1` – Command palette
- `gsap@3.12.2` – Animations

**Styling:**
- `tailwindcss@4.x` – CSS framework
- `postcss@8.x` – CSS processing
- `@tailwindcss/postcss` – Tailwind PostCSS plugin

**Development:**
- `typescript@5.x` – Type checking
- `vite@5.x` – Component bundling
- `tsup` – CLI bundling
- `tsx` – TypeScript executor

### Peer Dependencies

Components require:
- `react@>=19.0.0`
- `react-dom@>=19.0.0`

---

## Development Workflows

### Adding a New Component

1. Create component directory:
   ```
   packages/components/src/components/my-component/
   ```

2. Create component files:
   ```
   my-component.tsx          # React component with React Aria
   my-component.module.css   # Component styles
   index.ts                  # Named exports
   ```

3. Export from main entry:
   ```typescript
   // packages/components/src/index.ts
   export { MyComponent } from './components/my-component'
   ```

4. Create demo in site:
   ```
   apps/site/src/lib/component-demos/my-component.tsx
   ```

5. Test locally:
   ```bash
   pnpm dev          # Run dev servers
   # Visit http://localhost:3000 to see your component
   ```

### Modifying the CLI

1. Edit CLI source:
   ```
   packages/cli/src/commands/ or packages/cli/src/core/
   ```

2. Test command locally:
   ```bash
   # Development
   node packages/cli/dist/bin/ui-lab.js init

   # Or from root during dev
   pnpm dev
   ```

3. Changes take effect after rebuild

### Updating Documentation

1. Modify or create MDX files:
   ```
   apps/site/content/docs/[slug].mdx
   ```

2. Changes hot-reload in development
3. Site automatically picks up new files

---

## Internal Package Communication

**Dependencies Flow:**

```
NPM Consumers
    ↓
@ui-lab/components (exports components)
    ↓
ui-lab-registry (imports components for metadata)
    ↓
ui-lab (imports registry for component validation)
    ↓
@ui-lab/site (imports components for demos)
```

**Important Notes:**
- No circular dependencies between packages
- Registry is read-only (auto-generated)
- CLI depends on registry but not on components
- Site uses components for demos but doesn't export them

---

## Publishing

### To npm

```bash
pnpm publish       # Interactive publish flow
```

Publishes three packages:
- `@ui-lab/components` – Component library
- `ui-lab-registry` – Component metadata
- `ui-lab` – CLI tool

### Version Management

- Versions defined in each `package.json`
- Use semantic versioning (major.minor.patch)
- Breaking changes increment major version

---

## Contributing

### Setup

```bash
git clone https://github.com/kyza0d/ui-lab.app.git
cd ui-lab/app
pnpm install       # Install dependencies
pnpm dev           # Start development servers
```

### Code Organization

- Follow existing patterns in codebase
- Use TypeScript for type safety
- Use CSS Modules for component styles
- Use React Aria hooks for accessibility

### Commit Guidelines

- Use conventional commit format (`feat:`, `fix:`, `docs:`, etc.)
- Keep commits focused on single concerns
- Reference issues when applicable

### Testing Code

```bash
pnpm type-check    # Verify TypeScript compilation
pnpm dev           # Manual testing in site
```

---

## Architecture Diagram

```
┌─────────────────────────────────────┐
│    NPM Consumers (projects)          │
│  (import ui-lab-components, cli)    │
└──────────────┬──────────────────────┘
               │
    ┌──────────┼──────────┬──────────┐
    │          │          │          │
┌───▼────┐  ┌──▼───┐  ┌───▼────┐  ┌──▼────┐
│@ui-lab/│  │ ui-  │  │@ui-lab/│  │React  │
│compnts │  │lab   │  │registry │  │Aria   │
│(Vite)  │  │(tsup)│  │(tsc)   │  │hooks  │
└────┬───┘  └──┬───┘  └────┬───┘  └──────┘
     │         │           │
     └─────────┼───────────┘
               │
        ┌──────▼──────────┐
        │Shared deps:     │
        │Tailwind CSS v4  │
        │Floating UI      │
        │GSAP, Lucide     │
        └─────────────────┘
```

---

## Key Takeaways

- **Monorepo Structure:** pnpm workspaces for unified dependency management
- **Clear Separation:** Components, registry, CLI, and site are independent packages
- **Build Pipeline:** Specialized tooling for each package (Vite, tsup, Next.js, tsc)
- **Dependency Flow:** Registry generates metadata, CLI uses it, site showcases components
- **Development:** Single `pnpm dev` command starts everything
- **Publishing:** All packages published to npm for consumer distribution
